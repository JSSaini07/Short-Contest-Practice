
$('document').ready(function(){
  pass=0;
  totalProblems=$('.easyLeft').children().length+$('.mediumLeft').children().length+$('.hardLeft').children().length-9;
  $('.score').text('0/'+totalProblems);
  if($($('.easyLeft')).children().length<=3)
  {
    $('.easy').addClass('disabled');
    pass=1;
  }
  else {
      $('.easy').addClass('active');
      $($('.easyLeft').children()[3]).addClass('selected');
      $('.mainContent').html($($('.easyLeft').children()[3]).data('problem'));
      $('.submitSolution').data('link','https://www.codechef.com/submit/'+
$($('.easyLeft').children()[3]).text());
  }
  if($($('.mediumLeft')).children().length<=3)
  {
    $('.medium').addClass('disabled');
  }
  else
  if(pass==1) {
      $('.medium').addClass('active');
      $($('.mediumLeft').children()[3]).addClass('selected');
      $('.easyLeft').css({'display':'none'});
      $('.mediumLeft').css({'display':'inline-block'});
      $('.mainContent').html($($('.mediumLeft').children()[3]).data('problem'));
      $('.submitSolution').data('link','https://www.codechef.com/submit/'+
$($('.mediumLeft').children()[3]).text());
      pass=0;
  }
  if($($('.hardLeft')).children().length<=3)
  {
    $('.hard').addClass('disabled');
  }
  else
  if(pass==1) {
    $('.hard').addClass('active');
    $($('.hardLeft').children()[3]).addClass('selected');
    $('.easyLeft').css({'display':'none'});
    $('.hardLeft').css({'display':'inline-block'});
    $('.mainContent').html($($('.hardLeft').children()[3]).data('problem'));
    $('.submitSolution').data('link','https://www.codechef.com/submit/'+
$($('.hardLeft').children()[3]).text());
  }
  $('.easy').on('click',function(){
    if(!$(this).hasClass('disabled')){
      $('.mainContent').show();
      $('.active').removeClass('active');
      $(this).addClass('active');
      $('.dashboardArea').hide();
      $('.mediumLeft').css({'display':'none'});
      $('.hardLeft').css({'display':'none'});
      $('.easyLeft').css({'display':'inline-block'});
      $($('.easyLeft').children()[3]).addClass('selected');
      $('.mainContent').html($($('.easyLeft').children()[3]).data('problem'));
      $('.submitSolution').data('link','https://www.codechef.com/submit/'+
$($('.easyLeft').children()[3]).text());
    }
  });
  $('.medium').on('click',function(){
    if(!$(this).hasClass('disabled')){
      $('.mainContent').show();
      $('.active').removeClass('active');
      $(this).addClass('active');
      $('.dashboardArea').hide();
      $('.easyLeft').css({'display':'none'});
      $('.hardLeft').css({'display':'none'});
      $('.mediumLeft').css({'display':'inline-block'});
      $($('.mediumLeft').children()[3]).addClass('selected');
      $('.mainContent').html($($('.mediumLeft').children()[3]).data('problem'));
      $('.submitSolution').data('link','https://www.codechef.com/submit/'+
$($('.mediumLeft').children()[3]).text());
    }
  });
  $('.hard').on('click',function(){
    if(!$(this).hasClass('disabled')){
      $('.mainContent').show();
      $('.active').removeClass('active');
      $(this).addClass('active');
      $('.dashboardArea').hide();
      $('.easyLeft').css({'display':'none'});
      $('.mediumLeft').css({'display':'none'});
      $('.hardLeft').css({'display':'inline-block'});
      $($('.hardLeft').children()[3]).addClass('selected');
      $('.mainContent').html($($('.hardLeft').children()[3]).data('problem'));
      $('.submitSolution').data('link','https://www.codechef.com/submit/'+
$($('.hardLeft').children()[3]).text());
    }
  });
  $('.problemName').on('click',function(){
    $('.selected').removeClass('selected');
    $(this).addClass('selected');
    $('.mainContent').html($(this).data('problem'));
    $('.submitSolution').data('link','https://www.codechef.com/submit/'+
$(this).text());
  });
  $('.submitSolution').on('click',function(){
    problemWindow=window.open($(this).data('link'));
  });
  $('.endTest').on('click',function(){
    $('.active').removeClass('active');
    $('.dashboard').addClass('active');
    $('mainContent').hide();
    $('.dashboardArea').show();
    $('.submitSolution').hide();
    $('.timer').hide();
    $('.endTest').hide();
    $('.easy').hide();
    $('.medium').hide();
    $('.hard').hide();
    $.ajax({
      url:'/endTest',
      method:'POST',
    })
  });
  $('.dashboard').on('click',function(){
    $('.active').removeClass('active');
    $(this).addClass('active');
    $('.leftPanel').hide();
    $('.mainContent').hide();
    $('.dashboardArea').show();
  });
});

$('.closeTest').on('click',function(){
  $('.endTest').click();
  location.reload();
  console.log('clicked on close test');
});

function routine() {
  $.ajax({
    url:'/routine',
    method:'POST',
    success:function(result){
      r=JSON.parse(result);
      easyCompleted=r.completed.easy.length;
      mediumCompleted=r.completed.medium.length;
      hardCompleted=r.completed.hard.length;
      easyTotal=r.easy.length;
      mediumTotal=r.medium.length;
      hardTotal=r.hard.length;
      totalCompleted=String.valueOf()(easyCompleted+mediumCompleted+hardCompleted);
      total=String.valueOf()(easyTotal+mediumTotal+hardTotal);
      score=(totalCompleted+'/'+total);
      if(totalCompleted==total)
      {
        console.log('all problems done');
        $('.endTest').click();
      }
      $('.score').text(score);
      x="";
      problemTypes=[r.completed.easy,r.completed.medium,r.completed.hard]
      for(i=0;i<3;i++)
      {
        problemsArray=problemTypes[i];
        for(j=0;j<problemsArray.length;j++)
        {
          x+="<div class='questionName'>"+problemsArray[j]+"</div>"
          $('.'+problemsArray[j]).addClass('completed');
        }
      }
      $('.dashboardQuestionsCompleted').html(x);
      validTime=r.timer;
      validMinutes=parseInt($('.timer').text().split(':')[1]);
      checkMinutes=validTime.split(':')[1];
      validSeconds=parseInt($('.timer').text().split(':')[2]);
      checkSeconds=validTime.split(':')[2];
      valueMinutes=(Math.max(validMinutes,checkMinutes)-Math.min(validMinutes,checkMinutes))*60;
      valueSeconds=(Math.max(validSeconds,checkSeconds)-Math.min(validSeconds,checkSeconds));
      value=Math.max(valueMinutes,valueSeconds)-Math.min(valueMinutes,valueSeconds);
      if($('.timer').text()!=validTime&&value>10){
        $('.timer').text(validTime);
      }
    }
  });
}

interval=setInterval(function(){routine()},5000);

function timer(){
  time=$('.timer').text();
  time=time.split(":");
  hours=parseInt(time[0]);
  minutes=parseInt(time[1]);
  seconds=parseInt(time[2]);
  if(hours==0&&minutes==0&&seconds==0)
  {
    clearInterval(timeInterval);
    console.log('time over');
    $('.endTest').click();
  }
  else
  if(seconds>0)
  {
    seconds--;
  }
  else
  if(seconds==0){
    if(minutes>0)
    {
      minutes-=1;
    }
    else
    if(minutes==0){
      hours-=1;
    }
    seconds=59;
  }
  time=[hours,minutes,seconds];
  time=time.join(':');
  seconds--;
  $('.timer').text(time);
}

timeInterval=setInterval(function(){timer()},1000);
